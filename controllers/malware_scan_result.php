<?php
function mo_wpns_showScanResults(){
		$mo_wpns_db_handler = new mo_MoWpnsDB();
		if(isset($_GET['view'])){
			if(isset($_GET['trust'])){
				$mo_wpns_db_handler->ignorefile(base64_decode(sanitize_text_field($_GET['trust'])));
			}
			else if(isset($_GET['trustchanged'])){
				$mo_wpns_db_handler->ignorechangedfile(sanitize_text_field($_GET['trustchanged']));
			}

			$listofignorefiles = $mo_wpns_db_handler->getlistofignorefiles();
			$ignorefiles = array();
			foreach($listofignorefiles as $row)
				$ignorefiles[$row->path] = array('signature'=>$row->signature,"id"=>$row->id);

			$result = $mo_wpns_db_handler->get_report_with_id(sanitize_text_field($_GET['view']));
			if(sizeof($result)>0){
				$detailreport = $mo_wpns_db_handler->get_detail_report_with_id(sanitize_text_field($_GET['view']));
				mo_show_scan_details($detailreport, $result, $ignorefiles);
			}
		}
		else{
			$str1= sanitize_text_field($_SERVER['REQUEST_URI']);
			$str1= str_replace("admin-ajax.php", "admin.php?page=mo_wpns_malwarescan", $str1);
			$currenturl = remove_query_arg('delete',$str1);
			$currenturl = remove_query_arg('view',$currenturl);
			$currenturl = remove_query_arg('trust',$currenturl);
			$currenturl = remove_query_arg('trustchanged',$currenturl);
			if(isset($_GET['delete'])){
				$mo_wpns_db_handler->delete_report(sanitize_text_field($_GET['delete']));
			}
			$result = $mo_wpns_db_handler->get_report();
			mo_show_scan_report($currenturl, $result);
		}
	}

?>